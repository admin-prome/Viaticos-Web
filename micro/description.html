<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:ImageSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/MsdnBase/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=E7E56B29F143D47BCA60969CE481A61D" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/48f894a0-3015-47f9-a6a8-b9dc54f8ea7dCombined.css,0:ImageSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/MsdnBase/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=CDD771F0B1A1A67679ABA1619E29D70B" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Using OAuth 2.0 Authorization Code Grant for accessing AAD Graph</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Using OAuth 2.0 Authorization Code Grant for accessing AAD Graph</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            windows azure active directory
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            OAuth, Windows Azure Rest API
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">2/14/2014</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Using-OAuth-20-Authorizatio-be5c71bd">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p><span style="font-size:small">This PHP sample application demonstrates&nbsp;how to use OAuth 2.0 Authorization code grant for delegated access of AAD resources via Graph. For a detailed walkthrough and how to set up the configuration for this application,
 read through this <a href="http://blogs.msdn.com/b/aadgraphteam/archive/2013/05/17/using-oauth-2-0-authorization-code-grant-for-delegated-access-of-directory-via-aad-graph.aspx" >
blog post</a>. You can see the announcement for</span>&nbsp;<span style="font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;; font-size:11pt"><a href="http://blogs.msdn.com/b/active_directory_team_blog/archive/2013/04/22/developer-preview-of-oauth-code-grant-and-aal-for-windows-store-apps.aspx" >developer
 preview for support of OAuth Code Grant in Azure Active Directory</a>&nbsp;here.</span></p>
<p><strong><span style="font-size:small">Important Note: You need to configure the sample application&nbsp;by following the steps in the &quot;Setting up the permissions&quot; section of the
<a href="http://blogs.msdn.com/b/aadgraphteam/archive/2013/05/17/using-oauth-2-0-authorization-code-grant-for-delegated-access-of-directory-via-aad-graph.aspx">
blog post</a> describing this sample and copy the client id, credentials key and App Url values to the Settings.PHP file. Otherwise the application will throw an error.</span></strong></p>
<h1><span>Building the Sample</span></h1>
<p><span style="font-size:small">You can use <a href="http://www.microsoft.com/web/webmatrix/" >
WebMatrix</a> to work with this PHP sample. WebMatrix is a free and light weight tool that will let you</span>
<span style="font-size:small">create web sites using various technologies like PHP, Asp.Net, Node.js etc. In order to run this sample in Web matrix, choose&nbsp; &quot;Open Site&quot; -&gt; &quot;Folder as Site&quot; and select the folder that contains all the downloaded files.
</span></p>
<p>&nbsp;</p>
<h1>Running the Sample App</h1>
<p><span style="font-size:small">This app is pre-configured to go against a demonstration company in Azure AD. Note: update your configuration (under the Site-&gt;Settings config), to use
<a href="http://localhost:9485">http://localhost:9485</a> </span></p>
<p><span style="font-size:small">When running the app, you will be prompted for user credentials, you can enter this demo user account's creds:</span></p>
<p><span style="font-size:small"><a href="http://code.msdn.microsoft.com/Using-OAuth-20-Authorizatio-be5c71bd/mailto:demoUser@graphDir1.onMicrosoft.com">demoUser@graphDir1.onMicrosoft.com</a>&nbsp;
</span><span style="font-size:small">password: &nbsp;graphDem0</span></p>
<p><span style="font-size:small">Note, editing is disabled for the application credentials used in this demo app. &nbsp;To edit, configure your Application in your Azure AD tenant, following the instructions from this
<a href="http://blogs.msdn.com/b/aadgraphteam/archive/2013/05/17/using-oauth-2-0-authorization-code-grant-for-delegated-access-of-directory-via-aad-graph.aspx" >
blog post</a>.</span></p>
<p><span style="font-size:20px; font-weight:bold"><span>Description</span></span></p>
<p><span style="font-size:small">The functionality provided by the PHP sample is very limited. The goal is to show how Authorization Code can be used to access AAD Graph and so the application does not do much beyond that. The first thing the application asks
 the customer to do is to authorize via the AAD portal. Typically the application would authenticate the user via WS-Fed or SAML protocol but to make things simple, the sample application directly takes user to authorization. Once authorized, user is redirected
 to a page showing his/her details. There is an Edit link at the bottom of this page. You can only use this link if you have are using Administrator credentials while authorizing the application. And this access check is not done by the application but by the
 Graph API. Here is a brief description of the files that are part of this sample.<br>
&bull;&nbsp;&nbsp;&nbsp;&nbsp; Authorize.php: It&rsquo;s the home page of the application and redirects the user to the AAD portal for retrieving authorization code.<br>
&bull;&nbsp;&nbsp;&nbsp;&nbsp; HandleAuthorizationResponse.php: The page handles the redirect from the AAD authorize page after the user authorizes.<br>
&bull;&nbsp;&nbsp;&nbsp;&nbsp; AuthorizationHelperForGraph.php: Takes care of putting together the URL for retrieving the authorization code and also getting the access token for accessing Graph using the authorization code fetched.<br>
&bull;&nbsp;&nbsp;&nbsp;&nbsp; GraphServiceAccessHelper.php: Takes care of putting together the HTTP requests to the Graph service and handling the JSON response.<br>
&bull;&nbsp;&nbsp;&nbsp;&nbsp; Settings.php: This file contains the constant values for clientId, Password, RedirectURI etc. that need to be updated to match the service principal you create (explained in the next section)<br>
&nbsp;</span></p>
<h1>More Information and Resources</h1>
<ul>
<li><span style="font-size:small">Microsoft Windows Azure Active Directory Graph API full description:<a href="http://msdn.microsoft.com/en-us/library/hh974476.aspx" >http://msdn.microsoft.com/en-us/library/hh974476.aspx</a>
</span></li></ul>
<ul>
<li><span style="font-size:small">Windows Azure Active Directory Graph Team blog:
<a href="http://blogs.msdn.com/b/aadgraphteam/">http://blogs.msdn.com/b/aadgraphteam/</a>
</span></li><li><span style="font-size:small">Walkthrough for&nbsp;securing a windows store application and REST service using AAD:
<a href="http://msdn.microsoft.com/en-us/library/windowsazure/79e09d59-08b9-446a-8ead-209134a4326d">
http://msdn.microsoft.com/en-us/library/windowsazure/79e09d59-08b9-446a-8ead-209134a4326d</a></span>
</li></ul>

</div>


    </div>
</body>
</html>
